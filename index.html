<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>USA Van + Rail Itinerary (Slim Map 15 days)</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>#map{height:60vh}</style>
</head>
<body><div id="map"></div>
<script>
const map=L.map('map').setView([39.5,-98.35],4);
L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);
async function load(){const res=await fetch('data/itinerary_spec.txt');return res.json();}
function decodePolyline(str,precision){let index=0,lat=0,lng=0,coordinates=[],shift=0,result=0,byte=null;precision=Math.pow(10,precision||5);while(index<str.length){shift=result=0;do{byte=str.charCodeAt(index++)-63;result|=(byte&0x1f)<<shift;shift+=5;}while(byte>=0x20);lat+=((result&1)?~(result>>1):(result>>1));shift=result=0;do{byte=str.charCodeAt(index++)-63;result|=(byte&0x1f)<<shift;shift+=5;}while(byte>=0x20);lng+=((result&1)?~(result>>1):(result>>1));coordinates.push([lat/precision,lng/precision]);}return coordinates;}
function draw(){fetch('data/itinerary_spec.txt').then(r=>r.json()).then(data=>{data.days.slice(0,15).forEach(d=>{(d.segments||[]).forEach(seg=>{const from=findPoint(data,seg.from),to=findPoint(data,seg.to);if(!from||!to)return;if(seg.mode==='road'){L.Routing.control({waypoints:[L.latLng(from.coords[0],from.coords[1]),L.latLng(to.coords[0],to.coords[1])],createMarker:()=>null,show:false,addWaypoints:false}).addTo(map);}else if(seg.mode==='rail'||seg.mode==='hike'){if(typeof seg.polyline==='string'&&seg.polyline.length){L.polyline(decodePolyline(seg.polyline),{color:seg.mode==='rail'?'blue':'green'}).addTo(map);}else if(Array.isArray(seg.polyline)&&seg.polyline.length){L.polyline(seg.polyline.map(c=>[c[0],c[1]]),{color:seg.mode==='rail'?'blue':'green'}).addTo(map);}else{L.polyline([from.coords,to.coords],{color:'gray',dashArray:'6,6'}).addTo(map);}}});});});}
function findPoint(data,id){for(const d of data.days){const p=(d.points||[]).find(x=>x.id===id);if(p)return p;}return null;}
draw();
</script></body></html>